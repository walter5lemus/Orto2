{% extends 'base/base.html' %}
{% load staticfiles %}
{% block title %}
	Control de Citas

{% endblock %}
{% block navbar %}
		<div class="bs-docs-section clearfix">
		    <div class="row">
		        <div class="col-lg-12">
		            <div class="bs-component">
		            	<nav class="navbar navbar-default">
		                	<div class="container-fluid">
		                  		<div class="navbar-header">
		                    		<a class="navbar-brand" href="http://localhost:8000/">SOUES</a>
		                  		</div>		   		
		                  		<ul class="nav navbar-nav navbar-right">
		                        	<li class="">
		                        		<a href="{%url 'logout' %}" role="button" aria-expanded="false">Cerrar Sesión<span></span></a>		                        		
		                      		</li>
		                    	</ul>
		                    	<div>	
		                    	<ul class="nav navbar-nav navbar-right">
		                        	<li class="">
		                        		<a href="#" class="navbar-brand" role="button" aria-expanded="false">{{user}}<span></span></a>
		                      		</li>
		                    	</ul>
		                    	</div>
		                  		<h1 style="color:white "> <center> </center></h1> 
		                  		<h2 style="color:white "> <center>  </center></h2> 		                  		
		                </div>
		            </nav>
		        </div>
           	</div>
        </div>
    </div>   
    {% endblock %} 
{% block header %}
<style type="text/css">
	
.divOcultar{
    padding: 20px;

}
.divOcultar2{
    padding: 20px;

}
</style>
{% endblock %}

{% block content %}
<form method="POST">
	{% csrf_token %}
	</form>
	<div class="row">
		<div class="col-md-6 col-md-offset-2">
			<div class="form-group">
					<label for="{{form.codigo.name}}">{{form.codigo.label}}</label>	
				{{form2.codigo}}		
			</div>
		</div>
		<div class="col-md-4">
				<br>
				<button class="btn btn-primary" onclick="buscar()">Buscar</button>
			</div>
	</div>

	<div class="row">
		<div class="col-md-8 col-md-offset-2">
			<div class="form-group">
					<label for="cod_expediente">Nombre del Paciente</label>	
				<input readonly type="text" class="form-control" id="id_nombre_estudiante">

			</div>
		</div>
	</div>

	<div class="row">
		<div class="col-md-8 col-md-offset-2">
			<div class="form-group">
					<label for="{{form.estudiante.name}}">{{form.estudiante.label}}</label>	
				{{form.estudiante}}
			</div>
		</div>
	</div>
	
	<div class="row">
		<div class="col-md-8 col-md-offset-2">
			<div class="form-group">
					<label for="{{form.aparato.name}}">{{form.aparato.label}}</label>	
				{{form.aparato}}
			</div>
		</div>
	</div>

	<div class="row">
		<div class="col-md-4 col-md-offset-2">
			<div class="form-group">
					<label for="{{form.mx.name}}">{{form.mx.label}}</label>	
					{{form.mx}}
			</div>
			<div class="row">
				<div class="col-md-6">
						<label for="{{form.md.name}}">{{form.md.label}}</label>	
						{{form.md}}
				</div>	
			</div>	
		</div>
		<div class="col-md-4 col-md-offset-2">
			<div class="form-group">
				<button class="btn btn-primary" onclick="urlss()">Registrar Cita</button>
			</div>	
		</div>	
	</div>

	
	<div class="row">
		<div class="col-md-8 col-md-offset-2 divOcultar">	
			{% csrf_token %}
			<div class="row">
				<div class="form-group">
					<div class="col-md-4 col-md-offset-2">
						<label for="{{form.aparato.name}}">{{form.aparato.label}}</label>	
						{{form3.aparato}}
					</div>
					<div class="col-md-6">
						<div class="col-md-6 ">
							<br>
							<label for="md">Mandibular (Md)</label>
							<input type="radio" name="radio" id="md" value="md">
						</div>
						<div class="col-md-4">
							<br>
							<label for="mx">Maxilar(Mx)</label>
							<input type="radio" name="radio" id="mx" value="mx">
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	<div class="row">
		<div class="col-md-10 col-md-offset-1 divOcultar">	
			<div class="form-group">
				<div class="col-md-2 col-md-offset-2">
						<label for="{{form2.fecha_cita.name}}">{{form2.fecha_cita.label}}</label>	
							{{form2.fecha_cita}}
				</div>
				<div class="col-md-2">
							<label for="{{form2.proxima_cita.name}}">{{form2.proxima_cita.label}}</label>	
						{{form2.proxima_cita}}
				</div>
				<div class="col-md-4">
							<label for="{{form4.observaciones.name}}">{{form4.observaciones.label}}</label>	
						{{form4.observaciones}}
				</div>
				<div class="col-md-4 col-md-offset-2">
							<label for="{{form4.resultados.name}}">{{form4.resultados.label}}</label>	
						{{form4.resultados}}
				</div>
				<div class="col-md-3">
				<br>
							<label for="{{form2.autorizacion.name}}">{{form2.autorizacion.label}}</label>	
						{{form2.autorizacion}}
				</div>
				<div class="col-md-2">
					<div class="form-group">
							<label for="{{form2.num_cita.name}}">{{form2.num_cita.label}}</label>	
						{{form2.num_cita}}
					</div>
				</div>
				<div class="col-md-12">
					<div class="col-md-4 col-md-offset-5">
						<button class="btn btn-primary" onclick="post1()" id="boton1">POST1</button>
						<button class="btn btn-primary" onclick="post2()" id="boton2">POST2</button>
					</div>
				</div>
			</div>
			
		</div>
	</div>

	<div class="table-responsive col-md-12">
		<div id="conteiner">
	
		</div>
	</div>




<script>

	function post1(){
		var codigo = $('#id_codigo').val();
		var aparato = $("#id_aparato2 option:selected").val()
		var radio = $('input:radio[name=radio]:checked').val();
		var estudiante = $('#id_estudiante').val();
		alert("Radio= "+radio+"/nAparato= "+aparato );
		

		$.ajax({
			//var i=0;
			data : {'aparato':aparato,'radio':radio,'codigo':codigo,'estudiante':estudiante},
			url : '/citas/post1/',
			type : 'POST',
			success: function(response){
				alert("Ingreso con exito");
				buscar();
			}
		});
	}

	function buscar(){
		var codigo = $('#id_codigo').val();
		$.ajax({
			data : {'codigo':codigo},
			url : '/citas/busqueda_ajax/',
			type : 'get',
			success: function(data){
				for (var i = 0; i < data.length; i++) {
					if (data[i].fields.nombre_completo=="fallo") {
						alert("No se encontraron datos con ese codigo de expediente");
					}
					else{
						$('#id_nombre_estudiante').val(data[i].fields.nombre_completo);

								$.ajax({
									data : {'codigo':codigo},
									url : '/citas/busqueda_ajax2/',
									type : 'get',
									success: function(data){
										for (var i = 0; i < data.length; i++) {
											var apa = data[i].fields.aparato
											
										switch ((apa-1)) {
										    case 0:
										        day = "Ortodoncia Fija";
										        break;
										    case 1:
										        day = "Boton de Nance";
										        break;
										    case 2:
										        day = "Boton de Nance";
										        break;
										    case 3:
										        day = "Arco Lingua";
										        break;
										    case 4:
										        day = "Tornillo Hirax";
										        break;
										    case 5:
										        day = "Barra Transpalatina";
										        break;
										    case 6:
										        day = "Botones";
										        break;
										    case 7:
										        day = "SN1";
										        break;
										    case 8:
										        day = "SN2";
										        break;
										    case 9:
										        day = "SN3";
										        break;
										    case 10:
										        day = "SN4";
										        break;
										    case 11:
										        day = "SN5";
										        break;
										    case 12:
										        day = "SN6";
										        break;
										    case 13:
										        day = "SN7";
										        break;
										    case 14:
										        day = "SN8";
										        break;
										    case 15:
										        day = "SN9";
										        break;
										    case 16:
										        day = "SN10";
										        break;
										    case 17:
										        day = "Pistas Planas Directas";
										        break;
										    case 18:
										        day = "Pistas Planas Indirectas";
										        break;
										    case 19:
										        day = "Aparato Bimler";
										        break;
										    case 20:
										        day = "Bionator";
										        break;
										    case 21:
										        day = "Otros";
										        break;
										}
											$('#id_aparato').val(day);
										}
									}
								});

								$.ajax({
									data : {'codigo':codigo},
									url : '/citas/registro_listar_citas/',
									type : 'get',	
									success: function(data2){

									    var tabla = '<table cellpadding="0"  cellspacing="0" border: 1px; class="table table-bordered" id="conteiner">';
						                tabla += '<thead>';
						                tabla += '<tr>';
						                tabla += '<th>N° de Control</th><th>Fecha de Cita</th><th>Aspectos Observados</th><th>Fecha proxima cita</th><th>Resultados Esperados</th><th>Aurorización del tutor</th>';		
						                tabla += '</tr>';
						                tabla += '</thead>';
						                tabla += '<tbody>';
						                tr = '';
						 
						                for (i = 0; i < data2.length; i++){
						                    tr += '<tr>';
						                    tr += '<td>'+(i+1)+'</td><td>'+data2[i].fields.fecha_cita+'</td><td>'+data2[i].fields.observaciones+'</td><td>'+data2[i].fields.proxima_cita+'</td><td>'+data2[i].fields.resultados+'</td><td>'+data2[i].fields.autorizacion+'</td>';
						                    tr += '</tr>';
						                }
						 
						                tabla += tr;
						                tabla += '</tbody></table>';
						 
						                $('#conteiner').html( tabla );
									}
								});

					}
				}
			},
			error: function(data){
				alert("No se encontraron datos con ese codigo de expediente");
			},
		});


	}


	function urlss(){

		var codigo = $('#id_codigo').val();
		if (codigo==''){
			alert("Digite el codigo del Expediente");
		}
		else{
			window.open("/citas/registro_cita/"+codigo+"/","ventana1","width=700,height=700,scrollbars=NO") 	
		}
		
		
	}
  
</script>


{% endblock %}
